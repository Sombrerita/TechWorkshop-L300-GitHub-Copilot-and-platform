@{
    ViewData["Title"] = "Chat";
}

<h2>Chat with Phi4</h2>

<div id="chat-area" style="width:100%;height:300px;overflow-y:auto;border:1px solid #ccc;padding:10px;margin-bottom:10px;background:#fafafa;"></div>

<div class="input-group mb-3">
    <input type="text" id="chat-input" class="form-control" placeholder="Type your message..." aria-label="Chat input">
    <button class="btn btn-primary" id="send-btn" type="button">Send</button>
</div>

<script>
    const chatArea = document.getElementById('chat-area');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');

    function appendMessage(sender, text) {
        const msgDiv = document.createElement('div');
        msgDiv.innerHTML = `<strong>${sender}:</strong> ${text}`;
        chatArea.appendChild(msgDiv);
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    sendBtn.onclick = async function() {
        const userMsg = chatInput.value.trim();
        if (!userMsg) return;
        appendMessage('You', userMsg);
        chatInput.value = '';
        const response = await fetch('/Chat/Send', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: userMsg })
        });
        if (response.ok) {
            const data = await response.json();
            appendMessage('Phi4', data.reply);
        } else {
            appendMessage('System', 'Error contacting Phi4 endpoint.');
        }
    };
</script>
